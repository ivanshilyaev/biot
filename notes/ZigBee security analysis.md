# ZigBee security analysis

[Link](https://courses.csail.mit.edu/6.857/2017/project/17.pdf)

### Сетевые уровни

- Физический (PHY)
- MAC
- Сетевой (NWK)
- Прикладной (APL)

### Централизованная модель безопасности

**Ключи сетевого уровня:**

- Сетевой ключ (network key) — ключ шифрования сообщений между всеми устройствами сети (широковещательных сообщений). Генерируется TC случайным образом. Распределяется между всеми подключающимися к сети устройствами и зашифровывается с помощью pre-configured link key (см. ниже)

**Ключи прикладного уровня:**

- Предустановленный глобальный ключ соединения (pre-configured global link key) — используется для шифрования сетевого ключа, когда тот предаётся от TC (Trust Center, доверительного центра). Одинаковый для всех узлов в сети — ZigBee 1.0 . Данный ключ может быть предустановлен ZigBee или производителем устройств. Ключ, предустановленный ZigBee (”5A 69 67 42 65 65 41 6C 6C 69 61 6E 63 65 30 39”, ZigbeeAlliance09), позволяет устройствам от различных производителей подключаться к одной сети. Ключ, установленный непосредственно производителям, позволяет объединяться в сеть только устройствам от этого производителя. Предустановлен во все устройства, только если не используется pre-configured unique link key (см. ниже)
- Предустановленный уникальный ключ соединения (pre-configured unique link key) — используется для шифрования сетевого ключа, когда тот предаётся от TC (Trust Center, доверительного центра). Уникальный для каждой пары (TC, узел) — ZigBee 3.0 . Предустановлен только в TC и один конкретный узел.
- Ключ соединения доверительного центра (Trust Center Link Key, TCLK) — используется между TC и одним конкретным узлом. Извлекается из pre-configured unique link key; передаётся от TC к узлу, шифруется с помощью network key и pre-configured unique link key. Используется для шифрования всех последующих сообщений между TC и узлом, заменяя pre-configured unique link key. (Узел продолжает хранить pre-configured unique link key для возможного повторного соединения в дальнейшем)
- Ключ соединения приложения (Application Link Key) — используется между парой узлов (без TC). Запрашивается у TC одним из узлов, генерируется TC случайным образом. Шифруется с помощью network key и pre-configured unique link key.

### Распределённая модель безопасности

- Network key
- Distributed Security Global Link Key
- Pre-configured Link Key

### Способы получения network key

1. В процессе подключения нового устройства. Эта уязвимость существует и осознанно оставлена разработчиками спецификации в целях сохранения баланса простоты, удобства, стоимости и безопасности. Однако окно для атаки очень маленькое
2. Заставить уже имеющиеся в сети устройства переподключаться и использовать первый способ

В случае раскрытия network key открываются возможности для чтения показателей датчиков, а также для отправки команд, которые будут считываться конечными устройствами (например, переключение света и т.д.)

Можно описать различные модели. Но обязательно в конце акцентировать внимание на том, что используется на данные момент (последний и самый современный вариант).

### Questions

- [ ]  Процесс подключения новых устройств: шаги и на каком уровне?
- [ ]  Какими ключами шифруются какие сообщения?

### Атаки

- replay attak
- jamming