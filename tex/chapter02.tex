\chapter{Безопасность сетевых протоколов IoT}

	\section{ZigBee}
	Одной из определяющих особенностей Zigbee является предоставление средства для осуществления 
	безопасной связи, защиты создания и транспортировки криптографических ключей, шифрования кадров 
	и управления устройствами. Данная особенность основывается на базовой структуре безопасности, определенной в 
	стандарте IEEE 802.15.4. Эта часть архитектуры опирается на правильное управление симметричными 
	ключами и корректную реализацию методов и политик безопасности.
	
	Основным механизмом обеспечения конфиденциальности является защита всего ключевого материала. 
	Доверие между сторонами предполагается при первоначальной установке ключей, а также при обработке 
	информации о безопасности.
	
	Проблема защита и безопасного распределения ключей является первостепенной в любой системе
	безопасности. Ключи никогда не должны передаваться по незащищенному каналу. В случае Zigbee 
	кратковременное исключение из этого правила происходит на начальном этапе добавления в сеть 
	ранее не сконфигурированного устройства. Модель сети Zigbee уделяет особое внимание соображениям
	безопасности, поскольку сети, формирующие свою структура <<на лету>> (ad-hoc сети), могут быть 
	физически доступны для внешних устройств. Также невозможно предсказать состояние рабочей среды.
	
	В стеке протоколов различные сетевые уровни не разделены криптографически, поэтому необходимыми 
	являются политики доступа. Открытая модель доверия внутри устройства позволяет совместно использовать 
	ключи, что значительно снижает потенциальную стоимость. Если могут существовать вредоносные устройства, 
	то каждая полезная нагрузка сетевого уровня должна быть зашифрована, чтобы несанкционированный 
	трафик мог быть немедленно прерван. Исключением, опять же, является передача сетевого ключа, 
	который передаёт единый уровень безопасности сети новому присоединяющемуся устройству.
	
	Zigbee использует симметричное шифрование AES с длинной ключа 128 бит для реализации своих механизмов 
	безопасности. Ключ может быть связан либо с сетью, что позволяет использовать его обоими уровнями 
	Zigbee и подуровнем MAC, либо с каналом, полученным в результате предварительной установки, соглашения 
	или транспортировки. Создание ключей канала связи основывается на использовании главного ключа. 
	В конечном итоге, по крайней мере, главный ключ (мастер-ключ) должен быть получен через безопасную 
	среду (с помощью защищённого канала связи или по предварительной установке), поскольку от этого 
	зависит безопасность всей сети. Главный ключ виден только на прикладном уровне. Различные службы 
	используют разные односторонние вариации ключа связи, чтобы избежать утечек и рисков безопасности.
	
	В безопасной сети для распределения ключей назначается одно специальное устройство, которому доверяют 
	другие устройства: так называемый удостоверяющий центр. При идеальном сценарии устройства должны 
	иметь адрес удостоверяющего центра и начальный главный ключ, предварительно загруженный в них. 
	Типичные приложения без особых требований к безопасности будут использовать для связи данный сетевой ключ, 
	предварительно предоставленный удостоверяющим центром.
	
	Архитектура безопасности распределена между сетевыми уровнями следующим образом:
	
	\begin{itemize}
		\item Подуровень MAC (уровень управления доступом к среде) способен обеспечивать надежные соединения
		между двумя устройствами. Как правило, уровень безопасности, который он использует, задается 
		верхними уровнями.
		\item Сетевой уровень управляет маршрутизацией, обрабатывает полученные сообщения и транслирует
		запросы. Исходящие кадры будут использовать ключ соединения в соответствии с маршрутизацией, 
		если он доступен; в противном случае для защиты полезной нагрузки от внешних устройств будет 
		использоваться сетевой ключ.
		\item Прикладной уровень обеспечивает создание ключей и транспортные услуги как для объектов
		сети, так и для приложений.
	\end{itemize}

	
	\section{Z-Wave}
	До 2008 года в спецификации Z-Wave не было никаких упоминаний о способах защиты каналов связи. 
	Таким образом, все устройства Z-Wave коммуницировали открыто. Это означало, что любая сеть Z-Wave 
	была доступна извне и взламывать её было не нужно. В 2008 в спецификацию было добавлено понятие 
	шифрования (Z-Wave S0 Security), а в качестве алгоритма шифрования был выбран AES с длиной ключа 128 бит. 
	Это изменение было призвано решить проблему распространения устройств Z-Wave. Однако разработчики
	не учли мелких деталей.
	
	В 2013 году в спецификации  Z-Wave S0 Security была обнаружена уязвимость. В момент первичной 
	инициализации соединения перед началом сеанса передачи данных устройству отправляется ключ шифрования.
	На тот момент этот ключ представлял собой последовательность из 128 нулей. Таким образом, злоумышленник
	мог легко подслушать первичный сеанс связи, ключ которого был заранее известен. Далее не
	составляло труда отследить последующие изменения ключей шифрования. В результате практически
	каждая Z-Wave сеть оказалась уязвимой.
	
	После этой истории репутация Z-Wave была существенно испорчена. Для решения проблемы в 2016 году
	появилась улучшенная версии спецификации Z-Wave S2 Security. В ней для первичной выработки ключей
	используется протокол Диффи-Хеллмана.
	
	
	\section{Wi-Fi}
		
		
